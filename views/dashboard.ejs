<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Betting Dashboard</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="dashboardStyles.css" rel="stylesheet"/>


</head>
<body class="bg-light py-4">

<div class="container">
  <h1 class="text-center mb-4 sa-green p-3 rounded">Sports Betting Dashboard</h1>

  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th scope="col">Sport</th>
        <th scope="col">League</th>
        <th scope="col">Event</th>
        <th scope="col">Date & Time</th>
        <th scope="col">Bets</th>
      </tr>
    </thead>
    <tbody>
      <% const seenTeams = new Set(); 
          advantages.forEach(advantage => {
          const homeName = advantage.outcomes[0].participant.name;
          const awayName = advantage.outcomes[1].participant.name;

          if (seenTeams.has(homeName) && seenTeams.has(awayName)) {
            return;
          }

          seenTeams.add(homeName);
          seenTeams.add(awayName);
      %>
      <tr>
        <td><%= advantage.market.event.participants[0].sport %></td>
        <td><%= advantage.market.event.competitionInstance.name %></td>
        <td><%= advantage.market.event.name %></td>
        <td><%= advantage.market.event.startTime %></td>
        <td>
          <button class="btn btn-green btn-sa" onclick='openbetModal({
            team1: "<%= homeName %>",
            team2: "<%= awayName %>",
            event: "<%= advantage.market.event.name %>",
            type: "<%= advantage.market.type %>",
            modifier1: "<%= advantage.outcomes[0].modifier %>" ,
            modifier2: "<%= advantage.outcomes[1].modifier %>",
            payout1: "<%= advantage.outcomes[0].payout %>",
            payout2: "<%= advantage.outcomes[1].payout %>",
            source1: "<%= advantage.outcomes[0].source %>",
            source2: "<%= advantage.outcomes[1].source %>"
          }) '>Place Bet</button>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>

  <form action="/home" method="GET">
    <button type="submit" class="btn btn-black btn-sa mt-3">Home</button>
  </form>
</div>

<!-- Bet Modal -->
<div class="modal fade" id="betModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content sa-yellow p-4">
      <div class="modal-heading mb-3">
        <h5 class="modal-title">Pick Winner</h5>
        <a href="#" onclick="closebetModal(event)">Back to List</a>
      </div>
      <div class="d-flex justify-content-around">
        <button id="team1Btn" class="btn btn-red btn-sa"></button>
        <button id="team2Btn" class="btn btn-blue btn-sa"></button>
      </div>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content sa-green p-4">
      <div class="modal-heading mb-3">
        <h5 class="modal-title">Confirm Bet</h5>
        <a href="#" onclick="closeConfirmModal(event)">Back to List</a>
      </div>
      <div class="mb-3">
        <p><strong>Team:</strong> <span id="confirmTeam"></span></p>
        <p><strong>Event:</strong> <span id="confirmEvent"></span></p>
        <p><strong>Type:</strong> <span id="confirmType"></span></p>
        <p><strong>Modifier:</strong> <span id="confirmModifier"></span></p>
        <p><strong>Payout:</strong> <span id="confirmPayout"></span></p>
        <p><strong>Source:</strong> <span id="confirmSource"></span></p>
      </div>
      <form action="/betSlip" method="POST" class="d-flex flex-column">
        <input id="formTeamName" type="hidden" name="teamName">
        <input id="formEventName" type="hidden" name="eventName">
        <input type="hidden" name="payout" id="formPayout" />
        <div class="d-flex justify-content-between">
          <button type="button" class="btn btn-secondary" onclick="closeConfirmModal(event)">Cancel</button>
          <button id="confirm" type="submit" class="btn btn-yellow btn-sa">Confirm</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap JS & Dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const betModal = new bootstrap.Modal(document.getElementById('betModal'));
  const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));

  function openbetModal(data) {
    const team1Btn = document.getElementById('team1Btn');
    const team2Btn = document.getElementById('team2Btn');

    team1Btn.textContent = data.team1 || 'N/A';
    team2Btn.textContent = data.team2 || 'N/A';

    team1Btn.onclick = () => openconfirmModal({
      team: data.team1,
      event: data.event,
      type: data.type,
      modifier: data.modifier1,
      payout: data.payout1,
      source: data.source1
    });

    team2Btn.onclick = () => openconfirmModal({
      team: data.team2,
      event: data.event,
      type: data.type,
      modifier: data.modifier2,
      payout: data.payout2,
      source: data.source2
    });

    betModal.show();
  }

  function closebetModal(event) {
    event.preventDefault();
    betModal.hide();
  }

  function openconfirmModal(data) {
    betModal.hide();

    document.getElementById('confirmTeam').textContent = data.team || 'N/A';
    document.getElementById('confirmEvent').textContent = data.event || 'N/A';
    document.getElementById('confirmType').textContent = data.type || 'N/A';
    document.getElementById('confirmModifier').textContent = data.modifier || 'N/A';
    document.getElementById('confirmPayout').textContent = data.payout || 'N/A';
    document.getElementById('confirmSource').textContent = data.source || 'N/A';

    document.getElementById('formTeamName').value = data.team || '';
    document.getElementById('formEventName').value = data.event || '';
    document.getElementById('formPayout').value = data.payout || '';

    confirmModal.show();
  }

  function closeConfirmModal(event) {
    event.preventDefault();
    confirmModal.hide();
  }
</script>
</body>
</html>